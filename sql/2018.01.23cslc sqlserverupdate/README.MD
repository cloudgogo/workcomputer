## 修改说明:
由于2017年8月份对于帐外分摊的取值规则发生部分变化,房租折旧的取值无法获取.
> 时间:2018-01-22    
> 修改人:高祥云
### 说明
之前对于分摊数据的取值在8月之前使用的依旧是通过分摊取值部门及分摊的取值科目进行取值,而8月份及往后使用资产卡片进行取值并计入所对应部门的对应科目.
### 解决方案
之前通过etl来进行分摊数据的取值,分摊数据总的展现在通过etl调用procedure进行实现,具体有两部分,第一部分获取成本元素表及分摊总值的存储过程,第二部分为分摊存储过程    
1. 对于第一部分的存储过程,由于是按年进行计算的,所以对分摊,为了简化修改过程,将计算分摊总值的过程从该程序中去除,并加入到第二部分分摊过程中去(分摊的存储过程总体是按月进行跑数的).
2. 对于第二部分修改,将之前的取数逻辑特例化,对于房租的取值使用资产卡片的结果,其他的依旧使用正常逻辑.
### 修改过程
1. 将两存储过程更新入数据库中
2. 将`[COST_OACCO_DEPART_GET_MAP]`表中对应的房租两项的取值部门修改为综合部,并删除`[COST_ALLOC_VALUE]`表中8月份之后的数据,sql请见SQL文件[updatemapping.sql](updatemapping.sql).
3. 修改分摊存储过程的参数对数据8月后的数据进行初始化到当前月.
### 注意事项
需要在执行存储过程前将之前已经跑出的数据进行删除后再进行跑数.
